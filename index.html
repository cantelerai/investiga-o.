<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mural de Investiga√ß√£o - Caso Show</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0c0c1d 0%, #1a1a2e 100%);
            color: #f0f0f0;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
        }

        /* HEADER */
        header {
            text-align: center;
            padding: 25px 20px;
            margin-bottom: 30px;
            border-bottom: 2px solid #2a2a4a;
            position: relative;
            background: rgba(26, 26, 46, 0.8);
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
        }

        h1 {
            font-size: 2.8rem;
            color: #ffffff;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.7);
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #a0a0d0;
            font-style: italic;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.5;
        }

        .investigation-tools {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .tool-btn {
            background: linear-gradient(to right, #2a2a4a, #3a3a6a);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .tool-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            background: linear-gradient(to right, #3a3a6a, #4a4a8a);
        }

        /* LEGENDA */
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        /* BOARD - O MURAL */
        .board {
            background: rgba(20, 20, 35, 0.9);
            border: 3px solid #3a3a6a;
            border-radius: 15px;
            min-height: 850px;
            padding: 25px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
            margin-bottom: 40px;
            overflow: hidden;
        }

        /* CARDS */
        .card {
            width: 300px;
            background: linear-gradient(145deg, #252540, #1e1e36);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
            position: absolute;
            cursor: move;
            z-index: 10;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.7);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #3a3a6a;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ffffff;
        }

        .card-subtitle {
            display: block;
            font-size: 0.95rem;
            color: #a0a0d0;
            font-weight: normal;
            margin-top: 5px;
        }

        .card-content {
            line-height: 1.6;
            margin-bottom: 15px;
            color: #d0d0f0;
            font-size: 1rem;
        }

        .card-members {
            background: rgba(58, 58, 106, 0.3);
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .member-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 8px;
        }

        .member {
            padding: 4px 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .member.in-video::before {
            content: "üé•";
            font-size: 0.8rem;
        }

        .card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }

        .tag {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .tag-evidence { background: #4a4aaa; color: white; }
        .tag-suspect { background: #aa4a4a; color: white; }
        .tag-witness { background: #4aaa4a; color: white; }
        .tag-leader { background: #aa7a4a; color: white; }
        .tag-connection { background: #7a4aaa; color: white; }
        .tag-doubt { background: #aa4a7a; color: white; }
        .tag-video { background: #4a7aaa; color: white; }

        /* CORES DOS CARDS POR CATEGORIA */
        .card-suspect {
            border-left: 6px solid #aa4a4a;
        }

        .card-witness {
            border-left: 6px solid #4aaa4a;
        }

        .card-leader {
            border-left: 6px solid #aa7a4a;
        }

        .card-authority {
            border-left: 6px solid #7a4aaa;
        }

        /* POSI√á√ïES INICIAIS DOS CARDS */
        #card-grupo {
            top: 650px;
            left: 400px;
        }

        #card-jheny {
            top: 100px;
            left: 150px;
        }

        #card-mauricio {
            top: 400px;
            left: 100px;
        }

        #card-rosa {
            top: 400px;
            left: 320px;
        }

        #card-sede {
            top: 100px;
            left: 700px;
        }

        #card-pastor-local {
            top: 650px;
            left: 150px;
        }

        #card-pastor-presidente {
            top: 650px;
            left: 750px;
        }

        /* LINHAS DE CONEX√ÉO */
        .connection-line {
            position: absolute;
            height: 3px;
            background-color: rgba(90, 90, 170, 0.7);
            transform-origin: 0 0;
            z-index: 5;
            pointer-events: none;
        }

        .connection-line.dashed {
            background: repeating-linear-gradient(
                to right,
                rgba(90, 90, 170, 0.7) 0px,
                rgba(90, 90, 170, 0.7) 10px,
                transparent 10px,
                transparent 20px
            );
        }

        .connection-label {
            position: absolute;
            background: rgba(26, 26, 46, 0.9);
            color: #a0a0d0;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 0.85rem;
            white-space: nowrap;
            z-index: 6;
            pointer-events: none;
            border: 1px solid #3a3a6a;
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: linear-gradient(145deg, #252540, #1e1e36);
            width: 90%;
            max-width: 700px;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.8);
            border: 2px solid #5a5aaa;
            position: relative;
            max-height: 85vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #3a3a6a;
        }

        .modal-title {
            font-size: 2.2rem;
            color: #ffffff;
        }

        .close-modal {
            background: #aa4a4a;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-body {
            line-height: 1.7;
            font-size: 1.1rem;
            color: #d0d0f0;
        }

        .modal-section {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(58, 58, 106, 0.3);
            border-radius: 10px;
        }

        .modal-section h3 {
            color: #a0a0d0;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .notes-section {
            background: rgba(20, 20, 35, 0.8);
            border: 1px solid #3a3a6a;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .note-item {
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(58, 58, 106, 0.3);
            border-radius: 6px;
            border-left: 4px solid #4a7aaa;
        }

        .note-date {
            font-size: 0.8rem;
            color: #a0a0d0;
            margin-bottom: 5px;
        }

        .modal-notes textarea {
            width: 100%;
            height: 120px;
            background: rgba(20, 20, 35, 0.8);
            border: 1px solid #3a3a6a;
            border-radius: 8px;
            padding: 15px;
            color: #f0f0f0;
            font-size: 1rem;
            resize: vertical;
            margin-bottom: 15px;
        }

        .modal-notes button {
            background: linear-gradient(to right, #3a6a3a, #4a8a4a);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .modal-notes button:hover {
            background: linear-gradient(to right, #4a8a4a, #5aaa5a);
        }

        .modal-notes button.delete-btn {
            background: linear-gradient(to right, #6a3a3a, #8a4a4a);
        }

        .modal-notes button.delete-btn:hover {
            background: linear-gradient(to right, #8a4a4a, #aa5a5a);
        }

        /* DATABASE INFO */
        .db-status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(26, 26, 46, 0.9);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #a0a0d0;
            border: 1px solid #3a3a6a;
            z-index: 1000;
        }

        /* TIMELINE */
        .timeline-container {
            margin-top: 40px;
            padding: 25px;
            background: rgba(20, 20, 35, 0.7);
            border-radius: 15px;
            border: 1px solid #3a3a6a;
        }

        .timeline-title {
            font-size: 1.8rem;
            color: #ffffff;
            margin-bottom: 25px;
            text-align: center;
        }

        .timeline {
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
        }

        .timeline::after {
            content: '';
            position: absolute;
            width: 6px;
            background: #5a5aaa;
            top: 0;
            bottom: 0;
            left: 50%;
            margin-left: -3px;
        }

        .timeline-item {
            padding: 10px 40px;
            position: relative;
            width: 50%;
            box-sizing: border-box;
        }

        .timeline-item:nth-child(odd) {
            left: 0;
        }

        .timeline-item:nth-child(even) {
            left: 50%;
        }

        .timeline-content {
            padding: 20px;
            background: rgba(58, 58, 106, 0.5);
            border-radius: 10px;
            border-left: 4px solid #5a5aaa;
        }

        .timeline-date {
            font-weight: bold;
            color: #a0a0d0;
            margin-bottom: 10px;
        }

        /* FOOTER */
        footer {
            text-align: center;
            padding: 25px;
            color: #a0a0d0;
            font-size: 0.9rem;
            border-top: 1px solid #2a2a4a;
            margin-top: 40px;
        }

        /* RESPONSIVIDADE */
        @media (max-width: 1200px) {
            .card {
                width: 280px;
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .card {
                width: 250px;
                position: relative !important;
                top: auto !important;
                left: auto !important;
                margin-bottom: 20px;
            }
            
            .board {
                display: flex;
                flex-direction: column;
                align-items: center;
            }
            
            .timeline::after {
                left: 31px;
            }
            
            .timeline-item {
                width: 100%;
                padding-left: 70px;
                padding-right: 25px;
            }
            
            .timeline-item:nth-child(even) {
                left: 0;
            }
            
            .db-status {
                bottom: 10px;
                left: 10px;
                right: 10px;
                font-size: 0.8rem;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- CABE√áALHO -->
        <header>
            <h1><i class="fas fa-search"></i> MURAL DE INVESTIGA√á√ÉO</h1>
            <p class="subtitle">Caso Show: Investiga√ß√£o de vazamento de informa√ß√£o. Banco de dados ativo.</p>
            
            <div class="investigation-tools">
                <button class="tool-btn" id="btnToggleLines">
                    <i class="fas fa-project-diagram"></i> Mostrar/Esconder Conex√µes
                </button>
                <button class="tool-btn" id="btnResetPositions">
                    <i class="fas fa-sync-alt"></i> Resetar Posi√ß√µes
                </button>
                <button class="tool-btn" id="btnViewAllNotes">
                    <i class="fas fa-database"></i> Ver Todas Anota√ß√µes
                </button>
                <button class="tool-btn" id="btnExportDB">
                    <i class="fas fa-file-export"></i> Exportar Banco de Dados
                </button>
                <button class="tool-btn" id="btnImportDB">
                    <i class="fas fa-file-import"></i> Importar Dados
                </button>
            </div>

            <!-- LEGENDA -->
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #aa4a4a;"></div>
                    <span>Suspeito Principal</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #4aaa4a;"></div>
                    <span>Testemunha/Envolvido</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #aa7a4a;"></div>
                    <span>L√≠der do Grupo</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #7a4aaa;"></div>
                    <span>Autoridade/Lideran√ßa</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #4a7aaa;"></div>
                    <span>Apareceu no V√≠deo</span>
                </div>
            </div>
        </header>

        <!-- MURAL INTERATIVO -->
        <div class="board" id="investigationBoard">
            <!-- GRUPO (TESTEMUNHAS) -->
            <div class="card card-witness" id="card-grupo">
                <div class="card-header">
                    <div>
                        <h3 class="card-title">Grupo do Show</h3>
                        <span class="card-subtitle">8 membros presentes</span>
                    </div>
                    <div class="card-actions">
                        <button class="card-btn btn-details" data-card="grupo">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    Estavam todos no show. Apenas 4 aparecem no v√≠deo. Nenhum teria motivo para vazar informa√ß√£o para Jheny.
                </div>
                <div class="card-members">
                    <strong>Membros:</strong>
                    <div class="member-list">
                        <div class="member in-video">Katia üé•</div>
                        <div class="member in-video">Karina üé•</div>
                        <div class="member in-video">Laysa üé•</div>
                        <div class="member in-video">Milena üé•</div>
                        <div class="member">Rayane</div>
                        <div class="member">Raiany</div>
                        <div class="member">Nicolly</div>
                        <div class="member">Samuel</div>
                        <div class="member">Emanuel</div>
                    </div>
                </div>
                <div class="card-tags">
                    <span class="tag tag-witness">Testemunhas</span>
                    <span class="tag tag-video">V√≠deo (4/9)</span>
                </div>
            </div>

            <!-- JHENY (SUSPEITA PRINCIPAL) -->
            <div class="card card-suspect" id="card-jheny">
                <div class="card-header">
                    <div>
                        <h3 class="card-title">Jheny</h3>
                        <span class="card-subtitle">FILHA DO PASTOR LOCAL</span>
                    </div>
                    <div class="card-actions">
                        <button class="card-btn btn-details" data-card="jheny">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <strong>SUSPEITA PRINCIPAL</strong><br>
                    1. Sabia previamente que iriam ao show<br>
                    2. √â filha do Pastor Local<br>
                    3. Se afastou do grupo<br>
                    4. Possui motivo? Ci√∫mes? Press√£o do pai?
                </div>
                <div class="card-tags">
                    <span class="tag tag-suspect">Suspeita Principal</span>
                    <span class="tag tag-connection">Conex√£o com Pastor</span>
                </div>
            </div>

            <!-- MAUR√çCIO (L√çDER) -->
            <div class="card card-leader" id="card-mauricio">
                <div class="card-header">
                    <div>
                        <h3 class="card-title">Maur√≠cio</h3>
                        <span class="card-subtitle">L√≠der do Grupo</span>
                    </div>
                    <div class="card-actions">
                        <button class="card-btn btn-details" data-card="mauricio">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    L√≠der. J√° teve conflitos com o grupo, n√£o vazaria para o pastor.
                </div>
                <div class="card-tags">
                    <span class="tag tag-leader">L√≠der</span>
                    <span class="tag tag-suspect">Conflitos Anteriores</span>
                </div>
            </div>

            <!-- ROSA (L√çDER) -->
            <div class="card card-leader" id="card-rosa">
                <div class="card-header">
                    <div>
                        <h3 class="card-title">Rosa</h3>
                        <span class="card-subtitle">L√≠der do Grupo</span>
                    </div>
                    <div class="card-actions">
                        <button class="card-btn btn-details" data-card="rosa">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    L√≠der. Sempre busca parecer que est√° "tudo sob controle".
                </div>
                <div class="card-tags">
                    <span class="tag tag-leader">L√≠der</span>
                    <span class="tag tag-connection">Controle de Narrativa</span>
                </div>
            </div>

            <!-- SEDE (ORIGEM DA FOFOCA) -->
            <div class="card card-suspect" id="card-sede">
                <div class="card-header">
                    <div>
                        <h3 class="card-title">Pessoal da Sede</h3>
                        <span class="card-subtitle">Administra√ß√£o Central</span>
                    </div>
                    <div class="card-actions">
                        <button class="card-btn btn-details" data-card="sede">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <strong>ORIGEM DA FOFOCA</strong><br>
                    Recebeu informa√ß√£o pelo post. Amplificou e transformou em "caso". Poss√≠vel vazamento daqui para Pastor Local/Jheny.
                </div>
                <div class="card-tags">
                    <span class="tag tag-suspect">Fonte da Fofoca</span>
                    <span class="tag tag-connection">Hub de Informa√ß√£o</span>
                </div>
            </div>

            <!-- PASTOR LOCAL (AUTORIDADE) -->
            <div class="card card-authority" id="card-pastor-local">
                <div class="card-header">
                    <div>
                        <h3 class="card-title">Pastor Local</h3>
                        <span class="card-subtitle">Pai de Jheny</span>
                    </div>
                    <div class="card-actions">
                        <button class="card-btn btn-details" data-card="pastor-local">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    J√° mentiu outras vezes. Disse que "chegou ao presidente". Pai de Jheny. Como soube? Da sede? De Jheny? Dos l√≠deres?
                </div>
                <div class="card-tags">
                    <span class="tag tag-doubt">Credibilidade Baixa</span>
                    <span class="tag tag-suspect">Mentiu Anteriormente</span>
                    <span class="tag tag-connection">Pai de Jheny</span>
                </div>
            </div>

            <!-- PASTOR PRESIDENTE (AUTORIDADE) -->
            <div class="card card-authority" id="card-pastor-presidente">
                <div class="card-header">
                    <div>
                        <h3 class="card-title">Pastor Presidente</h3>
                        <span class="card-subtitle">Lideran√ßa M√°xima</span>
                    </div>
                    <div class="card-actions">
                        <button class="card-btn btn-details" data-card="pastor-presidente">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    N√£o conhece o grupo. D√∫vida se realmente soube. Pastor Local pode ter mentido sobre "chegar ao presidente".
                </div>
                <div class="card-tags">
                    <span class="tag tag-doubt">Informa√ß√£o Incerta</span>
                    <span class="tag tag-connection">√öltimo na Cadeia</span>
                </div>
            </div>
            
            <!-- AS LINHAS DE CONEX√ÉO SER√ÉO INSERIDAS AQUI VIA JAVASCRIPT -->
        </div>

        <!-- AN√ÅLISE DA INVESTIGA√á√ÉO -->
        <div class="timeline-container">
            <h2 class="timeline-title"><i class="fas fa-user-secret"></i> HIP√ìTESES DA INVESTIGA√á√ÉO</h2>
            
            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-content">
                        <div class="timeline-date">Hip√≥tese 1 (Mais Prov√°vel)</div>
                        <p><strong>Jheny ‚Üí Pastor Local ‚Üí Sede ‚Üí Pastor Presidente</strong><br>
                        Jheny (que sabia) contou ao pai (Pastor Local). Ele levou √† sede, que espalhou como fofoca e alegou ter ido ao Presidente.</p>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-content">
                        <div class="timeline-date">Hip√≥tese 2</div>
                        <p><strong>Maur√≠cio/Rosa ‚Üí Pastor Local/Jheny ‚Üí Pastor Presidente</strong><br>
                        L√≠deres comentaram ao Pastor Local que alegou ter ido ao Presidente.</p>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-content">
                        <div class="timeline-date">Hip√≥tese 3 (Improv√°vel)</div>
                        <p><strong>Grupo ‚Üí Jheny ‚Üí Pastor Local ‚Üí Cadeia</strong><br>
                        ALGU√âM do grupo vazou para Jheny (ningu√©m teria motivo). Esta hip√≥tese √© fraca.</p>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-content">
                        <div class="timeline-date">Perguntas-Chave</div>
                        <p>1. COMO Jheny soube?<br>
                        2. O Pastor Local realmente contou ao Presidente?<br>
                        3. Por que a Sede transformaria isso em caso?<br>
                        4. Motivo do afastamento de Jheny?</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODAL PARA DETALHES -->
        <div class="modal" id="detailsModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title" id="modalCardTitle">Detalhes</h2>
                    <button class="close-modal" id="closeModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <h3>Descri√ß√£o Completa</h3>
                        <p id="modalCardDescription">Descri√ß√£o completa do envolvido.</p>
                    </div>
                    <div class="modal-section">
                        <h3>Rela√ß√µes e Conex√µes</h3>
                        <ul id="modalCardConnections"></ul>
                    </div>
                    <div class="modal-section">
                        <h3>Anota√ß√µes Salvas</h3>
                        <div class="notes-section" id="savedNotes"></div>
                    </div>
                    <div class="modal-section modal-notes">
                        <h3>Adicionar Nova Anota√ß√£o</h3>
                        <textarea id="noteTextarea" placeholder="Digite sua anota√ß√£o aqui..."></textarea>
                        <div>
                            <button id="saveNoteBtn">Salvar Anota√ß√£o</button>
                            <button id="deleteAllNotesBtn" class="delete-btn">Apagar Todas Anota√ß√µes</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODAL PARA TODAS AS ANOTA√á√ïES -->
        <div class="modal" id="allNotesModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title"><i class="fas fa-database"></i> Todas as Anota√ß√µes da Investiga√ß√£o</h2>
                    <button class="close-modal" id="closeAllNotesModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <h3>Anota√ß√µes por Pessoa</h3>
                        <div id="allNotesList"></div>
                    </div>
                    <div class="modal-section">
                        <button id="exportNotesBtn" class="tool-btn" style="width: 100%;">
                            <i class="fas fa-download"></i> Exportar Todas as Anota√ß√µes
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- STATUS DO BANCO DE DADOS -->
        <div class="db-status" id="dbStatus">
            <i class="fas fa-database"></i> Banco de dados: <span id="dbStatusText">Carregando...</span>
        </div>

        <!-- RODAP√â -->
        <footer>
            <p><i class="fas fa-shield-alt"></i> Mural de Investiga√ß√£o - Caso Show | Banco de dados local ativo</p>
            <p style="margin-top: 10px; font-size: 0.8rem;">Todas as anota√ß√µes s√£o salvas automaticamente no seu navegador.</p>
        </footer>
    </div>

    <script>
        // ================================
        // BANCO DE DADOS INDEXEDDB
        // ================================
        class InvestigationDB {
            constructor() {
                this.db = null;
                this.dbName = 'InvestigationCaseShow';
                this.dbVersion = 1;
                this.initializeDB();
            }

            initializeDB() {
                const request = indexedDB.open(this.dbName, this.dbVersion);

                request.onerror = (event) => {
                    console.error('Erro ao abrir banco de dados:', event.target.error);
                    this.updateStatus('Erro ao carregar', 'error');
                };

                request.onsuccess = (event) => {
                    this.db = event.target.result;
                    console.log('Banco de dados carregado com sucesso');
                    this.updateStatus('Conectado', 'success');
                    
                    // Carregar anota√ß√µes existentes
                    this.loadAllNotes();
                };

                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    
                    // Criar object store para anota√ß√µes
                    if (!db.objectStoreNames.contains('notes')) {
                        const notesStore = db.createObjectStore('notes', { keyPath: 'id', autoIncrement: true });
                        notesStore.createIndex('cardId', 'cardId', { unique: false });
                        notesStore.createIndex('timestamp', 'timestamp', { unique: false });
                        console.log('Object store "notes" criado');
                    }

                    // Criar object store para posi√ß√µes dos cards
                    if (!db.objectStoreNames.contains('cardPositions')) {
                        const positionsStore = db.createObjectStore('cardPositions', { keyPath: 'cardId' });
                        console.log('Object store "cardPositions" criado');
                    }

                    // Criar object store para configura√ß√µes
                    if (!db.objectStoreNames.contains('settings')) {
                        const settingsStore = db.createObjectStore('settings', { keyPath: 'key' });
                        console.log('Object store "settings" criado');
                    }
                };
            }

            updateStatus(text, type = 'info') {
                const statusEl = document.getElementById('dbStatusText');
                statusEl.textContent = text;
                
                const colors = {
                    success: '#4aaa4a',
                    error: '#aa4a4a',
                    info: '#4a7aaa'
                };
                
                statusEl.style.color = colors[type] || colors.info;
            }

            // ========== OPERA√á√ïES DE ANOTA√á√ïES ==========
            async saveNote(cardId, noteText) {
                if (!this.db || !noteText.trim()) return false;

                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['notes'], 'readwrite');
                    const store = transaction.objectStore('notes');
                    
                    const note = {
                        cardId: cardId,
                        text: noteText.trim(),
                        timestamp: new Date().toISOString(),
                        dateDisplay: new Date().toLocaleString('pt-BR')
                    };

                    const request = store.add(note);

                    request.onsuccess = () => {
                        console.log('Anota√ß√£o salva:', note);
                        this.updateStatus('Anota√ß√£o salva', 'success');
                        resolve(true);
                    };

                    request.onerror = (event) => {
                        console.error('Erro ao salvar anota√ß√£o:', event.target.error);
                        this.updateStatus('Erro ao salvar', 'error');
                        resolve(false);
                    };
                });
            }

            async getNotesByCard(cardId) {
                if (!this.db) return [];

                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['notes'], 'readonly');
                    const store = transaction.objectStore('notes');
                    const index = store.index('cardId');
                    const request = index.getAll(cardId);

                    request.onsuccess = () => {
                        const notes = request.result.sort((a, b) => 
                            new Date(b.timestamp) - new Date(a.timestamp)
                        );
                        resolve(notes);
                    };

                    request.onerror = () => {
                        console.error('Erro ao buscar anota√ß√µes');
                        resolve([]);
                    };
                });
            }

            async getAllNotes() {
                if (!this.db) return [];

                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['notes'], 'readonly');
                    const store = transaction.objectStore('notes');
                    const request = store.getAll();

                    request.onsuccess = () => {
                        const notes = request.result.sort((a, b) => 
                            new Date(b.timestamp) - new Date(a.timestamp)
                        );
                        resolve(notes);
                    };

                    request.onerror = () => {
                        console.error('Erro ao buscar todas as anota√ß√µes');
                        resolve([]);
                    };
                });
            }

            async deleteAllNotes() {
                if (!this.db) return false;

                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['notes'], 'readwrite');
                    const store = transaction.objectStore('notes');
                    const request = store.clear();

                    request.onsuccess = () => {
                        console.log('Todas as anota√ß√µes apagadas');
                        this.updateStatus('Todas anota√ß√µes apagadas', 'success');
                        resolve(true);
                    };

                    request.onerror = (event) => {
                        console.error('Erro ao apagar anota√ß√µes:', event.target.error);
                        this.updateStatus('Erro ao apagar', 'error');
                        resolve(false);
                    };
                });
            }

            async deleteNotesByCard(cardId) {
                if (!this.db) return false;

                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['notes'], 'readwrite');
                    const store = transaction.objectStore('notes');
                    const index = store.index('cardId');
                    
                    const getAllRequest = index.getAllKeys(cardId);
                    
                    getAllRequest.onsuccess = () => {
                        const keys = getAllRequest.result;
                        if (keys.length === 0) {
                            resolve(true);
                            return;
                        }

                        let deletedCount = 0;
                        keys.forEach(key => {
                            const deleteRequest = store.delete(key);
                            deleteRequest.onsuccess = () => {
                                deletedCount++;
                                if (deletedCount === keys.length) {
                                    console.log(`Anota√ß√µes de ${cardId} apagadas`);
                                    this.updateStatus('Anota√ß√µes apagadas', 'success');
                                    resolve(true);
                                }
                            };
                            deleteRequest.onerror = () => {
                                console.error('Erro ao apagar anota√ß√£o');
                                resolve(false);
                            };
                        });
                    };

                    getAllRequest.onerror = () => {
                        console.error('Erro ao buscar chaves para apagar');
                        resolve(false);
                    };
                });
            }

            // ========== OPERA√á√ïES DE POSI√á√ïES ==========
            async saveCardPosition(cardId, left, top) {
                if (!this.db) return false;

                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['cardPositions'], 'readwrite');
                    const store = transaction.objectStore('cardPositions');
                    
                    const position = {
                        cardId: cardId,
                        left: left,
                        top: top,
                        timestamp: new Date().toISOString()
                    };

                    const request = store.put(position);

                    request.onsuccess = () => {
                        resolve(true);
                    };

                    request.onerror = (event) => {
                        console.error('Erro ao salvar posi√ß√£o:', event.target.error);
                        resolve(false);
                    };
                });
            }

            async getAllCardPositions() {
                if (!this.db) return {};

                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['cardPositions'], 'readonly');
                    const store = transaction.objectStore('cardPositions');
                    const request = store.getAll();

                    request.onsuccess = () => {
                        const positions = {};
                        request.result.forEach(pos => {
                            positions[pos.cardId] = { left: pos.left, top: pos.top };
                        });
                        resolve(positions);
                    };

                    request.onerror = () => {
                        console.error('Erro ao buscar posi√ß√µes');
                        resolve({});
                    };
                });
            }

            async clearAllPositions() {
                if (!this.db) return false;

                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['cardPositions'], 'readwrite');
                    const store = transaction.objectStore('cardPositions');
                    const request = store.clear();

                    request.onsuccess = () => {
                        console.log('Posi√ß√µes apagadas');
                        resolve(true);
                    };

                    request.onerror = () => {
                        console.error('Erro ao apagar posi√ß√µes');
                        resolve(false);
                    };
                });
            }

            // ========== EXPORT/IMPORT ==========
            async exportAllData() {
                if (!this.db) return null;

                const [notes, positions] = await Promise.all([
                    this.getAllNotes(),
                    this.getAllCardPositions()
                ]);

                return {
                    metadata: {
                        exportDate: new Date().toISOString(),
                        case: "Caso Show - Investiga√ß√£o",
                        version: "1.0"
                    },
                    notes: notes,
                    positions: positions
                };
            }

            async importData(data) {
                if (!this.db || !data) return false;

                try {
                    // Importar anota√ß√µes
                    if (data.notes && Array.isArray(data.notes)) {
                        for (const note of data.notes) {
                            await this.saveNote(note.cardId, note.text);
                        }
                    }

                    // Importar posi√ß√µes
                    if (data.positions && typeof data.positions === 'object') {
                        for (const [cardId, position] of Object.entries(data.positions)) {
                            await this.saveCardPosition(cardId, position.left, position.top);
                        }
                    }

                    this.updateStatus('Dados importados com sucesso', 'success');
                    return true;
                } catch (error) {
                    console.error('Erro ao importar dados:', error);
                    this.updateStatus('Erro ao importar', 'error');
                    return false;
                }
            }

            // ========== CARREGAR DADOS INICIAIS ==========
            async loadAllNotes() {
                // Esta fun√ß√£o √© chamada automaticamente quando o banco carrega
                console.log('Banco de dados pronto para uso');
            }
        }

        // ================================
        // APLICA√á√ÉO PRINCIPAL
        // ================================
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar banco de dados
            const investigationDB = new InvestigationDB();
            
            // Configura√ß√µes iniciais
            const currentDate = new Date();
            document.getElementById('currentDate').textContent = currentDate.toLocaleDateString('pt-BR');
            
            // Dados das conex√µes
            const connections = [
                { from: 'card-jheny', to: 'card-pastor-local', label: 'Rela√ß√£o Pai/Filha', dashed: false },
                { from: 'card-jheny', to: 'card-sede', label: 'Como a Sede soube?', dashed: true },
                { from: 'card-grupo', to: 'card-mauricio', label: 'Lideran√ßa', dashed: false },
                { from: 'card-grupo', to: 'card-rosa', label: 'Lideran√ßa', dashed: false },
                { from: 'card-mauricio', to: 'card-sede', label: 'Informou sobre show', dashed: false },
                { from: 'card-rosa', to: 'card-sede', label: 'Contato frequente', dashed: false },
                { from: 'card-sede', to: 'card-pastor-local', label: 'Informou Pastor Local?', dashed: true },
                { from: 'card-pastor-local', to: 'card-pastor-presidente', label: 'Alega ter informado', dashed: true },
                { from: 'card-sede', to: 'card-pastor-presidente', label: 'Canal oficial (direto?)', dashed: false }
            ];
            
            // Dados detalhados para o modal
            const cardDetails = {
                'grupo': {
                    title: "Grupo do Show (9 membros)",
                    description: "Todos estavam no show, mas apenas 4 aparecem no v√≠deo: Katia, Karina, Laysa e Milena. Os outros 5 (Rayane, Raiany, Nicolly, Samuel e Emanuel) n√£o s√£o vis√≠veis. Segundo sua informa√ß√£o, NINGU√âM do grupo teria motivo para vazar informa√ß√£o para Jheny, o que a isenta de suspeita inicial.",
                    connections: [
                        "9 membros no total",
                        "4 aparecem no v√≠deo (evid√™ncia)",
                        "5 n√£o aparecem no v√≠deo",
                        "Nenhum teria motivo para vazar para Jheny",
                        "Maur√≠cio e Rosa s√£o os l√≠deres formais"
                    ]
                },
                'jheny': {
                    title: "Jheny - SUSPEITA PRINCIPAL",
                    description: "FILHA DO PASTOR LOCAL. Ela sabia previamente que o grupo iria ao show. Se afastou recentemente do grupo, o que coincide com o timing do vazamento. Como filha do Pastor Local, tem acesso a informa√ß√µes privilegiadas e pode ter sido pressionada ou decidiu contar ao pai.",
                    connections: [
                        "Filha do Pastor Local - acesso direto √† lideran√ßa",
                        "Sabia dos planos ANTES do show",
                        "Afastamento (SUSPEITO)",
                        "Ponto de vazamento mais prov√°vel",
                        "Como a Sede soube? Atrav√©s dela ou do pai?"
                    ]
                },
                'mauricio': {
                    title: "Maur√≠cio (L√≠der)",
                    description: "L√≠der do grupo, contaria ao pastor?.",
                    connections: [
                        "Teve conflitos com o pastor",
                        "J√° brigou com o grupo",
                        "N√£o teria motivo para vazar",
                        "Pode ter sido fonte involunt√°ria para a sede"
                    ]
                },
                'rosa': {
                    title: "Rosa (L√≠der)",
                    description: "L√≠der. Sempre busca parecer que est√° 'tudo sob controle'. Extremamente preocupada com a imagem do grupo.",
                    connections: [
                        "Busca manter controle sobre todas as situa√ß√µes",
                        "Tem contado ao pastor",
                        "Pode ter relatado para controlar narrativa",
                        "N√£o teria motivo para vazar para sede"
                    ]
                },
                'sede': {
                    title: "Pessoal da Sede - ORIGEM DA FOFOCA",
                    description: "ORIGEM PROV√ÅVEL DA FOFOCA. A sede central recebeu a informa√ß√£o atrav√©s de m√∫ltiplas fontes (Maur√≠cio e/ou Rosa). Funciona como amplificador - transformou um coment√°rio casual em 'caso'. Possui funcion√°rio conhecido por espalhar fofocas.",
                    connections: [
                        "Recebeu informa√ß√£o pelo post",
                        "Amplificou e transformou em 'caso'",
                        "Funcion√°rio conhecido por fofocas",
                        "Ponto central de dissemina√ß√£o",
                        "Como Jheny soube? Da sede ou para a sede?"
                    ]
                },
                'pastor-local': {
                    title: "Pastor Local (Pai de Jheny)",
                    description: "J√° mentiu outras vezes para 'proteger a imagem da igreja'. Disse que 'chegou ao presidente'. Pai de Jheny. Como soube da informa√ß√£o? 1) Da Sede (mais prov√°vel), 2) Da filha Jheny (que sabia previamente), 3) Inventou para parecer importante.",
                    connections: [
                        "Pai de Jheny - rela√ß√£o familiar direta",
                        "Recebeu informa√ß√£o: da Sede? de Jheny?",
                        "Hist√≥rico de mentiras 'para proteger igreja'",
                        "Alega ter informado ao Presidente (n√£o confirmado)",
                        "Credibilidade question√°vel"
                    ]
                },
                'pastor-presidente': {
                    title: "Pastor Presidente",
                    description: "N√£o conhece o grupo pessoalmente. H√° fortes d√∫vidas se realmente soube do caso ou se o Pastor Local mentiu sobre 'ter chegado ao presidente'. Toma decis√µes com base em relat√≥rios filtrados pela sede.",
                    connections: [
                        "N√£o conhece o grupo pessoalmente",
                        "Possivelmente NUNCA foi informado sobre o caso",
                        "Recebe informa√ß√µes filtradas pela sede",
                        "Pastor Local pode ter mentido sobre t√™-lo informado",
                        "√öltimo elo na cadeia (se a cadeia existir)"
                    ]
                }
            };

            // VARI√ÅVEIS GLOBAIS
            let linesVisible = true;
            let draggedCard = null;
            let currentCardId = null;

            // ELEMENTOS DO DOM
            const board = document.getElementById('investigationBoard');
            const modal = document.getElementById('detailsModal');
            const allNotesModal = document.getElementById('allNotesModal');
            const modalTitle = document.getElementById('modalCardTitle');
            const modalDescription = document.getElementById('modalCardDescription');
            const modalConnections = document.getElementById('modalCardConnections');
            const savedNotesEl = document.getElementById('savedNotes');
            const noteTextarea = document.getElementById('noteTextarea');
            const saveNoteBtn = document.getElementById('saveNoteBtn');
            const deleteAllNotesBtn = document.getElementById('deleteAllNotesBtn');
            const closeModalBtn = document.getElementById('closeModal');
            const closeAllNotesModalBtn = document.getElementById('closeAllNotesModal');
            const btnToggleLines = document.getElementById('btnToggleLines');
            const btnResetPositions = document.getElementById('btnResetPositions');
            const btnViewAllNotes = document.getElementById('btnViewAllNotes');
            const btnExportDB = document.getElementById('btnExportDB');
            const btnImportDB = document.getElementById('btnImportDB');
            const allNotesList = document.getElementById('allNotesList');
            const exportNotesBtn = document.getElementById('exportNotesBtn');

            // INICIALIZA√á√ÉO
            async function init() {
                drawConnectionLines();
                setupEventListeners();
                makeCardsDraggable();
                await loadSavedPositions();
            }

            // DESENHAR LINHAS DE CONEX√ÉO
            function drawConnectionLines() {
                document.querySelectorAll('.connection-line, .connection-label').forEach(el => el.remove());
                
                connections.forEach(conn => {
                    const fromCard = document.getElementById(conn.from);
                    const toCard = document.getElementById(conn.to);
                    
                    if (!fromCard || !toCard) return;
                    
                    const fromRect = fromCard.getBoundingClientRect();
                    const toRect = toCard.getBoundingClientRect();
                    const boardRect = board.getBoundingClientRect();
                    
                    const fromX = fromRect.left + fromRect.width / 2 - boardRect.left;
                    const fromY = fromRect.top + fromRect.height / 2 - boardRect.top;
                    const toX = toRect.left + toRect.width / 2 - boardRect.left;
                    const toY = toRect.top + toRect.height / 2 - boardRect.top;
                    
                    const distance = Math.sqrt(Math.pow(toX - fromX, 2) + Math.pow(toY - fromY, 2));
                    const angle = Math.atan2(toY - fromY, toX - fromX) * (180 / Math.PI);
                    
                    // Criar linha
                    const line = document.createElement('div');
                    line.className = `connection-line ${conn.dashed ? 'dashed' : ''}`;
                    line.style.width = `${distance}px`;
                    line.style.left = `${fromX}px`;
                    line.style.top = `${fromY}px`;
                    line.style.transform = `rotate(${angle}deg)`;
                    line.style.opacity = linesVisible ? '0.7' : '0';
                    line.title = conn.label;
                    
                    board.appendChild(line);
                    
                    // Adicionar label no meio da linha
                    const labelX = fromX + (toX - fromX) / 2;
                    const labelY = fromY + (toY - fromY) / 2;
                    
                    const label = document.createElement('div');
                    label.className = 'connection-label';
                    label.textContent = conn.label;
                    label.style.left = `${labelX}px`;
                    label.style.top = `${labelY}px`;
                    label.style.opacity = linesVisible ? '1' : '0';
                    label.style.transform = `translate(-50%, -50%)`;
                    
                    board.appendChild(label);
                });
            }

            // CONFIGURAR EVENT LISTENERS
            function setupEventListeners() {
                // Bot√µes de detalhes dos cards
                document.querySelectorAll('.btn-details').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const cardId = this.getAttribute('data-card');
                        openCardModal(cardId);
                    });
                });

                // Cards clic√°veis
                document.querySelectorAll('.card').forEach(card => {
                    card.addEventListener('click', function(e) {
                        if (!e.target.closest('.card-btn')) {
                            const cardId = this.id.replace('card-', '');
                            openCardModal(cardId);
                        }
                    });
                });

                // Fechar modais
                closeModalBtn.addEventListener('click', () => modal.style.display = 'none');
                closeAllNotesModalBtn.addEventListener('click', () => allNotesModal.style.display = 'none');
                
                window.addEventListener('click', function(e) {
                    if (e.target === modal) modal.style.display = 'none';
                    if (e.target === allNotesModal) allNotesModal.style.display = 'none';
                });

                // Salvar anota√ß√£o
                saveNoteBtn.addEventListener('click', saveNote);

                // Apagar anota√ß√µes
                deleteAllNotesBtn.addEventListener('click', deleteAllNotesForCurrentCard);

                // Bot√µes de controle
                btnToggleLines.addEventListener('click', toggleLines);
                btnResetPositions.addEventListener('click', resetCardPositions);
                btnViewAllNotes.addEventListener('click', viewAllNotes);
                btnExportDB.addEventListener('click', exportDatabase);
                btnImportDB.addEventListener('click', importDatabase);
                exportNotesBtn.addEventListener('click', exportAllNotes);

                // Redesenhar linhas ao redimensionar
                window.addEventListener('resize', drawConnectionLines);
            }

            // ABRIR MODAL COM DETALHES
            async function openCardModal(cardId) {
                const details = cardDetails[cardId];
                if (!details) return;

                currentCardId = cardId;
                modalTitle.textContent = details.title;
                modalDescription.textContent = details.description;
                
                modalConnections.innerHTML = '';
                details.connections.forEach(conn => {
                    const li = document.createElement('li');
                    li.textContent = conn;
                    li.style.marginBottom = '8px';
                    li.style.padding = '8px';
                    li.style.background = 'rgba(58, 58, 106, 0.3)';
                    li.style.borderRadius = '5px';
                    modalConnections.appendChild(li);
                });

                // Carregar anota√ß√µes do banco de dados
                await loadNotesForCard(cardId);
                
                noteTextarea.value = '';
                modal.style.display = 'flex';
            }

            // CARREGAR ANOTA√á√ïES DO BANCO DE DADOS
            async function loadNotesForCard(cardId) {
                if (!investigationDB.db) return;

                const notes = await investigationDB.getNotesByCard(cardId);
                savedNotesEl.innerHTML = '';

                if (notes.length === 0) {
                    savedNotesEl.innerHTML = '<p style="color: #a0a0d0; text-align: center;">Nenhuma anota√ß√£o salva ainda.</p>';
                    return;
                }

                notes.forEach(note => {
                    const noteEl = document.createElement('div');
                    noteEl.className = 'note-item';
                    noteEl.innerHTML = `
                        <div class="note-date">${note.dateDisplay}</div>
                        <div>${note.text}</div>
                    `;
                    savedNotesEl.appendChild(noteEl);
                });
            }

            // SALVAR ANOTA√á√ÉO NO BANCO DE DADOS
            async function saveNote() {
                if (!currentCardId || !noteTextarea.value.trim()) {
                    alert('Digite uma anota√ß√£o antes de salvar!');
                    return;
                }

                const success = await investigationDB.saveNote(currentCardId, noteTextarea.value.trim());
                
                if (success) {
                    // Recarregar anota√ß√µes
                    await loadNotesForCard(currentCardId);
                    noteTextarea.value = '';
                    
                    // Feedback visual
                    const originalText = saveNoteBtn.textContent;
                    saveNoteBtn.textContent = 'Salvo!';
                    saveNoteBtn.style.background = '#2a9d8f';
                    
                    setTimeout(() => {
                        saveNoteBtn.textContent = 'Salvar Anota√ß√£o';
                        saveNoteBtn.style.background = '';
                    }, 1500);
                }
            }

            // APAGAR ANOTA√á√ïES DO CARD ATUAL
            async function deleteAllNotesForCurrentCard() {
                if (!currentCardId || !confirm('Tem certeza que deseja apagar TODAS as anota√ß√µes deste card?')) {
                    return;
                }

                const success = await investigationDB.deleteNotesByCard(currentCardId);
                
                if (success) {
                    await loadNotesForCard(currentCardId);
                    
                    // Feedback visual
                    const originalText = deleteAllNotesBtn.textContent;
                    deleteAllNotesBtn.textContent = 'Apagadas!';
                    deleteAllNotesBtn.style.background = '#8a4a4a';
                    
                    setTimeout(() => {
                        deleteAllNotesBtn.textContent = 'Apagar Todas Anota√ß√µes';
                        deleteAllNotesBtn.style.background = '';
                    }, 1500);
                }
            }

            // VER TODAS AS ANOTA√á√ïES
            async function viewAllNotes() {
                if (!investigationDB.db) {
                    alert('Banco de dados ainda n√£o carregou. Aguarde alguns segundos.');
                    return;
                }

                const allNotes = await investigationDB.getAllNotes();
                allNotesList.innerHTML = '';

                if (allNotes.length === 0) {
                    allNotesList.innerHTML = '<p style="color: #a0a0d0; text-align: center;">Nenhuma anota√ß√£o salva ainda.</p>';
                } else {
                    // Agrupar por cardId
                    const groupedNotes = {};
                    
                    allNotes.forEach(note => {
                        if (!groupedNotes[note.cardId]) {
                            groupedNotes[note.cardId] = [];
                        }
                        groupedNotes[note.cardId].push(note);
                    });

                    // Criar HTML para cada grupo
                    Object.entries(groupedNotes).forEach(([cardId, notes]) => {
                        const cardName = getCardDisplayName(cardId);
                        const section = document.createElement('div');
                        section.style.marginBottom = '25px';
                        section.innerHTML = `
                            <h4 style="color: #ffffff; margin-bottom: 10px; border-bottom: 1px solid #3a3a6a; padding-bottom: 5px;">
                                ${cardName} (${notes.length} anota√ß√µes)
                            </h4>
                        `;

                        notes.forEach(note => {
                            const noteEl = document.createElement('div');
                            noteEl.className = 'note-item';
                            noteEl.style.marginBottom = '10px';
                            noteEl.innerHTML = `
                                <div class="note-date">${note.dateDisplay}</div>
                                <div>${note.text}</div>
                            `;
                            section.appendChild(noteEl);
                        });

                        allNotesList.appendChild(section);
                    });
                }

                allNotesModal.style.display = 'flex';
            }

            // EXPORTAR TODAS AS ANOTA√á√ïES
            async function exportAllNotes() {
                if (!investigationDB.db) return;

                const allNotes = await investigationDB.getAllNotes();
                
                if (allNotes.length === 0) {
                    alert('N√£o h√° anota√ß√µes para exportar.');
                    return;
                }

                const exportData = {
                    metadata: {
                        exportDate: new Date().toISOString(),
                        case: "Caso Show - Investiga√ß√£o",
                        totalNotes: allNotes.length
                    },
                    notes: allNotes
                };

                const dataStr = JSON.stringify(exportData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `anotacoes_investigacao_${new Date().toISOString().split('T')[0]}.json`;
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            }

            // EXPORTAR BANCO DE DADOS COMPLETO
            async function exportDatabase() {
                if (!investigationDB.db) {
                    alert('Banco de dados ainda n√£o carregou.');
                    return;
                }

                const data = await investigationDB.exportAllData();
                
                if (!data) {
                    alert('Erro ao exportar dados.');
                    return;
                }

                const dataStr = JSON.stringify(data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `backup_investigacao_${new Date().toISOString().split('T')[0]}.json`;
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                // Feedback
                investigationDB.updateStatus('Backup exportado', 'success');
            }

            // IMPORTAR BANCO DE DADOS
            async function importDatabase() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    
                    reader.onload = async (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            
                            if (!confirm('Importar dados ir√° ADICIONAR √†s anota√ß√µes existentes. Continuar?')) {
                                return;
                            }

                            const success = await investigationDB.importData(data);
                            
                            if (success) {
                                alert('Dados importados com sucesso!');
                                // Recarregar se tiver um card aberto
                                if (currentCardId) {
                                    await loadNotesForCard(currentCardId);
                                }
                            } else {
                                alert('Erro ao importar dados. Verifique o formato do arquivo.');
                            }
                        } catch (error) {
                            alert('Erro ao ler arquivo. Certifique-se de que √© um arquivo JSON v√°lido.');
                            console.error('Erro ao importar:', error);
                        }
                    };
                    
                    reader.readAsText(file);
                };
                
                input.click();
            }

            // TORNAR CARDS ARRAST√ÅVEIS
            function makeCardsDraggable() {
                const cards = document.querySelectorAll('.card');
                
                cards.forEach(card => {
                    card.addEventListener('mousedown', startDrag);
                    card.addEventListener('touchstart', startDragTouch, { passive: false });
                });

                function startDrag(e) {
                    e.preventDefault();
                    draggedCard = this;
                    
                    const shiftX = e.clientX - draggedCard.getBoundingClientRect().left;
                    const shiftY = e.clientY - draggedCard.getBoundingClientRect().top;
                    
                    function moveAt(pageX, pageY) {
                        const boardRect = board.getBoundingClientRect();
                        
                        let newX = pageX - shiftX - boardRect.left;
                        let newY = pageY - shiftY - boardRect.top;
                        
                        newX = Math.max(10, Math.min(newX, boardRect.width - draggedCard.offsetWidth - 10));
                        newY = Math.max(10, Math.min(newY, boardRect.height - draggedCard.offsetHeight - 10));
                        
                        draggedCard.style.left = `${newX}px`;
                        draggedCard.style.top = `${newY}px`;
                    }
                    
                    function onMouseMove(e) {
                        moveAt(e.clientX, e.clientY);
                    }
                    
                    function onTouchMove(e) {
                        const touch = e.touches[0];
                        moveAt(touch.clientX, touch.clientY);
                    }
                    
                    document.addEventListener('mousemove', onMouseMove);
                    document.addEventListener('touchmove', onTouchMove, { passive: false });
                    
                    function onMouseUp() {
                        document.removeEventListener('mousemove', onMouseMove);
                        document.removeEventListener('mouseup', onMouseUp);
                        document.removeEventListener('touchmove', onTouchMove);
                        document.removeEventListener('touchend', onTouchEnd);
                        
                        drawConnectionLines();
                        saveCardPosition(draggedCard.id, draggedCard.style.left, draggedCard.style.top);
                    }
                    
                    function onTouchEnd() {
                        onMouseUp();
                    }
                    
                    document.addEventListener('mouseup', onMouseUp, { once: true });
                    document.addEventListener('touchend', onTouchEnd, { once: true });
                }
                
                function startDragTouch(e) {
                    e.preventDefault();
                    startDrag.call(this, e.touches[0]);
                }
            }

            // SALVAR POSI√á√ÉO DO CARD NO BANCO DE DADOS
            async function saveCardPosition(cardId, left, top) {
                if (!investigationDB.db) return;
                
                await investigationDB.saveCardPosition(cardId, left, top);
            }

            // CARREGAR POSI√á√ïES SALVAS
            async function loadSavedPositions() {
                if (!investigationDB.db) {
                    // Tentar novamente em 1 segundo se o banco ainda n√£o carregou
                    setTimeout(loadSavedPositions, 1000);
                    return;
                }

                const positions = await investigationDB.getAllCardPositions();
                
                Object.keys(positions).forEach(cardId => {
                    const card = document.getElementById(cardId);
                    if (card && positions[cardId]) {
                        card.style.left = positions[cardId].left;
                        card.style.top = positions[cardId].top;
                    }
                });
                
                setTimeout(drawConnectionLines, 100);
            }

            // ALTERNAR VISIBILIDADE DAS LINHAS
            function toggleLines() {
                linesVisible = !linesVisible;
                document.querySelectorAll('.connection-line, .connection-label').forEach(el => {
                    el.style.opacity = linesVisible ? (el.classList.contains('connection-line') ? '0.7' : '1') : '0';
                });
                
                btnToggleLines.innerHTML = linesVisible 
                    ? '<i class="fas fa-project-diagram"></i> Esconder Conex√µes' 
                    : '<i class="fas fa-project-diagram"></i> Mostrar Conex√µes';
            }

            // RESETAR POSI√á√ïES DOS CARDS
            async function resetCardPositions() {
                if (!confirm('Resetar todas as posi√ß√µes para o padr√£o?')) return;

                const defaultPositions = {
                    'card-grupo': { left: '400px', top: '650px' },
                    'card-jheny': { left: '150px', top: '100px' },
                    'card-mauricio': { left: '100px', top: '400px' },
                    'card-rosa': { left: '320px', top: '400px' },
                    'card-sede': { left: '700px', top: '100px' },
                    'card-pastor-local': { left: '150px', top: '650px' },
                    'card-pastor-presidente': { left: '750px', top: '650px' }
                };

                Object.keys(defaultPositions).forEach(cardId => {
                    const card = document.getElementById(cardId);
                    if (card) {
                        card.style.left = defaultPositions[cardId].left;
                        card.style.top = defaultPositions[cardId].top;
                        saveCardPosition(cardId, defaultPositions[cardId].left, defaultPositions[cardId].top);
                    }
                });

                await investigationDB.clearAllPositions();
                drawConnectionLines();
                
                investigationDB.updateStatus('Posi√ß√µes resetadas', 'success');
            }

            // FUN√á√ÉO AUXILIAR PARA NOMES DOS CARDS
            function getCardDisplayName(cardId) {
                const names = {
                    'grupo': 'Grupo do Show',
                    'jheny': 'Jheny (Suspeita Principal)',
                    'mauricio': 'Maur√≠cio (L√≠der)',
                    'rosa': 'Rosa (L√≠der)',
                    'sede': 'Pessoal da Sede',
                    'pastor-local': 'Pastor Local',
                    'pastor-presidente': 'Pastor Presidente'
                };
                return names[cardId] || cardId;
            }

            // INICIALIZAR
            init();
        });
    </script>
</body>
</html>
